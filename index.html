<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEWS.FM</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700;900&display=swap');

        :root {
            --bg: #111;
            --panel: #1a1a1a;
            --active: #fff;
            --inactive: #555;
            --accent: #1db954; /* é»˜è®¤ç»¿ */
        }

        body {
            margin: 0; background: var(--bg); color: #fff;
            font-family: 'Noto Sans SC', sans-serif;
            height: 100vh; overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* èƒŒæ™¯æµå…‰ */
        .bg-glow {
            position: fixed; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, var(--accent) 0%, transparent 60%);
            opacity: 0.15; transition: background 1s ease; pointer-events: none; z-index: -1;
        }

        /* ä¸»å¸ƒå±€ï¼šå·¦å°é¢ å³åˆ—è¡¨ */
        .container {
            flex: 1; display: flex; max-width: 1200px; margin: 0 auto; width: 100%;
            padding: 40px; box-sizing: border-box; gap: 50px;
            align-items: center;
        }

        /* å·¦ä¾§ */
        .left-side { width: 350px; text-align: center; flex-shrink: 0; }
        
        .cover-box {
            width: 100%; aspect-ratio: 1/1; background: #222;
            border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            margin-bottom: 30px; transition: 0.5s; border: 1px solid rgba(255,255,255,0.1);
        }
        .cover-title { font-size: 40px; font-weight: 900; letter-spacing: -2px; line-height: 1; }
        .cover-subtitle { font-size: 14px; color: #888; margin-top: 10px; letter-spacing: 2px; text-transform: uppercase; }

        .voice-switch { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .v-btn {
            background: rgba(255,255,255,0.1); border: none; color: #aaa;
            padding: 8px 16px; border-radius: 20px; cursor: pointer; transition: 0.2s; font-size: 12px;
        }
        .v-btn:hover { background: rgba(255,255,255,0.2); color: #fff; }
        .v-btn.active { background: var(--accent); color: #000; font-weight: bold; transform: scale(1.05); }

        /* å³ä¾§ (æ­Œè¯æ¨¡å¼) */
        .right-side {
            flex: 1; height: 70vh; overflow-y: auto;
            mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
            scrollbar-width: none; position: relative;
        }
        .right-side::-webkit-scrollbar { display: none; }

        .news-row {
            padding: 20px 0; color: var(--inactive); transition: 0.4s;
            cursor: pointer; opacity: 0.6; transform: scale(0.95); transform-origin: left center;
        }
        .news-row:hover { opacity: 1; color: #bbb; }
        
        .news-row.active {
            opacity: 1; color: var(--active); transform: scale(1);
            text-shadow: 0 0 20px rgba(255,255,255,0.2);
        }
        
        .news-tag { 
            font-size: 12px; display: inline-block; padding: 2px 6px; 
            border-radius: 4px; margin-bottom: 5px; border: 1px solid currentColor; opacity: 0.7;
        }
        .news-title { font-size: 24px; font-weight: 700; margin-bottom: 8px; line-height: 1.2; }
        .news-desc { font-size: 16px; font-weight: 400; opacity: 0.8; }

        /* åº•éƒ¨æ’­æ”¾æ¡ */
        .bottom-bar {
            height: 90px; background: rgba(20,20,20,0.9);
            backdrop-filter: blur(20px); border-top: 1px solid rgba(255,255,255,0.1);
            display: flex; flex-direction: column; justify-content: center;
            padding: 0 20px; z-index: 100;
        }
        
        .progress-wrap { width: 100%; height: 4px; background: #333; cursor: pointer; position: absolute; top: 0; left: 0; }
        .progress { height: 100%; background: var(--accent); width: 0%; transition: width 0.1s linear; position: relative; }
        .progress::after { content:''; position:absolute; right:-6px; top:-4px; width:12px; height:12px; background:#fff; border-radius:50%; opacity:0; transition:0.2s; }
        .progress-wrap:hover .progress::after { opacity: 1; }

        .controls-row { display: flex; justify-content: center; align-items: center; gap: 40px; margin-top: 10px; }
        .ctrl-btn { background: none; border: none; color: #fff; cursor: pointer; transition: 0.2s; display: flex; align-items: center; }
        .ctrl-btn:hover { color: var(--accent); }
        .play-big { 
            width: 50px; height: 50px; border-radius: 50%; background: #fff; color: #000; 
            justify-content: center; font-size: 20px;
        }
        .play-big:hover { transform: scale(1.1); color: #000; background: var(--accent); }

        .time-info { position: absolute; right: 30px; font-size: 12px; color: #666; font-family: monospace; }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .container { flex-direction: column; padding: 20px; gap: 20px; }
            .left-side { width: 100%; display: flex; gap: 20px; align-items: center; text-align: left; }
            .cover-box { width: 100px; height: 100px; margin: 0; }
            .track-info { flex: 1; }
            .cover-title { font-size: 24px; }
            .right-side { width: 100%; padding: 0; height: 50vh; mask-image: none; }
            .news-title { font-size: 18px; }
            .news-desc { font-size: 14px; }
        }
    </style>
</head>
<body>

<div class="bg-glow" id="bgGlow"></div>

<div class="container">
    <div class="left-side">
        <div class="cover-box" id="albumCover">
            <div class="cover-title" id="coverTitle">NEWS</div>
            <div class="cover-subtitle">Daily Briefing</div>
        </div>
        <div class="track-info">
            <h2 style="margin:0;font-size:18px;">å…¨ç½‘èµ„è®¯é€š</h2>
            <p style="color:#666;margin:5px 0 20px;" id="updateTime">Loading...</p>
            <div class="voice-switch" id="voiceBox"></div>
        </div>
    </div>

    <div class="right-side" id="newsList">
        </div>
</div>

<div class="bottom-bar">
    <div class="progress-wrap" id="progWrap">
        <div class="progress" id="progFill"></div>
    </div>
    <div class="controls-row">
        <button class="ctrl-btn"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg></button>
        <button class="ctrl-btn play-big" id="playBtn">â–¶</button>
        <button class="ctrl-btn"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg></button>
    </div>
    <div class="time-info">
        <span id="currTime">0:00</span> / <span id="totalTime">0:00</span>
    </div>
</div>

<audio id="audio"></audio>

<script>
    const audio = document.getElementById('audio');
    const newsListEl = document.getElementById('newsList');
    const bgGlow = document.getElementById('bgGlow');
    const albumCover = document.getElementById('albumCover');
    const coverTitle = document.getElementById('coverTitle');
    const progFill = document.getElementById('progFill');
    const playBtn = document.getElementById('playBtn');
    const ts = new Date().getTime();

    let newsData = [];
    let metaData = {};
    let currentVoice = 'yunxi';

    // é…è‰²æ–¹æ¡ˆ
    const colors = {
        'ç§‘æŠ€': '#3b82f6', // è“
        'å¨±ä¹': '#ec4899', // ç²‰
        'å¥‡é—»': '#eab308', // é»„
        'default': '#1db954' // ç»¿
    };

    // åˆå§‹åŒ–
    fetch(`news_data.json?t=${ts}`)
        .then(res => res.json())
        .then(data => {
            newsData = data.news;
            metaData = data.meta;
            document.getElementById('updateTime').innerText = `${data.date} ${data.hour}:00 æ›´æ–°`;

            // ç”Ÿæˆå£°éŸ³æŒ‰é’®
            const vb = document.getElementById('voiceBox');
            data.voices.forEach(v => {
                let b = document.createElement('button');
                b.className = `v-btn ${v.id===currentVoice?'active':''}`;
                b.innerText = v.label.split('Â·')[0];
                b.onclick = () => switchVoice(v.id, b);
                vb.appendChild(b);
            });

            // æ¸²æŸ“åˆ—è¡¨
            renderNews();

            // åŠ è½½éŸ³é¢‘
            audio.src = `radio_${currentVoice}.mp3?v=${ts}`;
        });

    function renderNews() {
        newsListEl.innerHTML = `<div class="news-row" id="row-intro" style="padding-top:100px">
            <div class="news-title">ğŸ‘‹ å‡†å¤‡æ’­æŠ¥</div>
            <div class="news-desc">åŒ—äº¬æ—¶é—´æ•´ç‚¹æ–°é—»ï¼Œå³å°†å¼€å§‹...</div>
        </div>`;

        newsData.forEach((item, i) => {
            newsListEl.innerHTML += `
                <div class="news-row" id="row-${i}" onclick="seekTo(${i})">
                    <span class="news-tag" style="color:${colors[item.category]}">${item.category}</span>
                    <div class="news-title">${item.title}</div>
                    <div class="news-desc">${item.summary}</div>
                </div>
            `;
        });
        
        // åº•éƒ¨å«é«˜
        newsListEl.innerHTML += `<div style="height:200px;"></div>`;
    }

    function switchVoice(id, btn) {
        if(id === currentVoice) return;
        currentVoice = id;
        document.querySelectorAll('.v-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        let playing = !audio.paused;
        audio.src = `radio_${id}.mp3?v=${new Date().getTime()}`;
        if(playing) audio.play();
    }

    // æ’­æ”¾æ§åˆ¶
    playBtn.onclick = () => {
        if(audio.paused) {
            audio.play();
            playBtn.innerText = "II";
        } else {
            audio.pause();
            playBtn.innerText = "â–¶";
        }
    };
    audio.onended = () => playBtn.innerText = "â–¶";

    // æ ¸å¿ƒåŒæ­¥é€»è¾‘
    audio.ontimeupdate = () => {
        if(!audio.duration) return;
        
        // è¿›åº¦æ¡
        let pct = (audio.currentTime / audio.duration);
        progFill.style.width = (pct*100)+'%';
        document.getElementById('currTime').innerText = fmtTime(audio.currentTime);
        document.getElementById('totalTime').innerText = fmtTime(audio.duration);

        // è®¡ç®—é«˜äº®
        // é€»è¾‘ï¼šæ ¹æ®å­—æ•°æ¯”ä¾‹æ¨ç®—å½“å‰è¯»åˆ°å“ªä¸€æ¡
        let totalLen = metaData.total_len;
        let currentLen = pct * totalLen;
        
        let activeIdx = -1;
        let countedLen = metaData.intro_len; // å…ˆç®—ä¸Šå¼€åœºç™½

        if(currentLen < countedLen) {
            activeIdx = -1; // å¼€åœºç™½é˜¶æ®µ
        } else {
            for(let i=0; i<newsData.length; i++) {
                countedLen += newsData[i].length;
                if(currentLen < countedLen) {
                    activeIdx = i;
                    break;
                }
            }
        }
        
        highlight(activeIdx);
    };

    let lastIdx = -999;
    function highlight(idx) {
        if(idx === lastIdx) return;
        lastIdx = idx;

        document.querySelectorAll('.news-row').forEach(r => r.classList.remove('active'));
        
        let targetId = idx === -1 ? 'row-intro' : `row-${idx}`;
        let el = document.getElementById(targetId);
        
        if(el) {
            el.classList.add('active');
            // å¹³æ»‘æ»šåŠ¨å±…ä¸­
            el.scrollIntoView({behavior: "smooth", block: "center"});
            
            // åˆ‡æ¢é¢œè‰²ä¸»é¢˜
            if(idx >= 0) {
                let cat = newsData[idx].category;
                let c = colors[cat];
                document.documentElement.style.setProperty('--accent', c);
                coverTitle.innerText = cat;
                coverTitle.style.color = c;
                albumCover.style.borderColor = c;
                // åŠ¨æ€èƒŒæ™¯
                bgGlow.style.background = `radial-gradient(circle, ${c} 0%, transparent 60%)`;
            } else {
                coverTitle.innerText = "NEWS";
                coverTitle.style.color = "#fff";
            }
        }
    }

    // è¾…åŠ©å‡½æ•°
    function fmtTime(s) {
        let m = Math.floor(s/60);
        let sec = Math.floor(s%60);
        return `${m}:${sec<10?'0'+sec:sec}`;
    }
    
    // ç®€å•çš„ç‚¹å‡»è¿›åº¦æ¡
    document.getElementById('progWrap').onclick = (e) => {
        let r = e.target.getBoundingClientRect();
        audio.currentTime = ((e.clientX - r.left)/r.width) * audio.duration;
    }

</script>
</body>
</html>
