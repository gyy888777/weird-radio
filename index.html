<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全网资讯通 · Music Player Style</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap');

        :root {
            --bg: #121212;
            --card: #1e1e1e;
            --text: #ffffff;
            --text-secondary: #b3b3b3;
            --accent: #1db954; /* Spotify Green */
            --accent-tech: #3b82f6;
            --accent-ent: #ec4899;
            --accent-weird: #eab308;
        }

        body {
            background-color: var(--bg); color: var(--text);
            font-family: 'Noto Sans SC', sans-serif;
            margin: 0; height: 100vh; display: flex; flex-direction: column;
            overflow: hidden; transition: background-image 0.5s;
        }

        /* 动态背景 */
        .bg-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.5), var(--bg));
            z-index: -1;
        }

        /* 头部 */
        header {
            padding: 20px; text-align: center; font-weight: bold; letter-spacing: 1px;
            display: flex; justify-content: center; align-items: center; gap: 10px;
        }
        .live-badge { background: #f00; font-size: 10px; padding: 2px 6px; border-radius: 4px; }

        /* 播放器主体 */
        .player-container {
            flex: 1; display: flex; flex-direction: column; padding: 20px;
            max-width: 500px; margin: 0 auto; width: 100%; box-sizing: border-box;
        }

        /* 专辑封面区 */
        .album-art {
            width: 100%; aspect-ratio: 1/1; background: #333; border-radius: 12px;
            margin-bottom: 25px; display: flex; align-items: center; justify-content: center;
            font-size: 40px; font-weight: bold; color: rgba(255,255,255,0.8);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-shadow: 0 2px 10px rgba(0,0,0,0.2);
            background-size: cover; background-position: center;
            transition: 0.3s;
        }
        /* 不同分类的封面背景 */
        .album-art[data-cat="科技"] { background-image: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .album-art[data-cat="娱乐"] { background-image: linear-gradient(135deg, #ec4899, #be185d); }
        .album-art[data-cat="奇闻"] { background-image: linear-gradient(135deg, #eab308, #a16207); }

        /* 歌曲信息 */
        .track-info { text-align: center; margin-bottom: 20px; }
        .track-title { font-size: 24px; font-weight: bold; margin-bottom: 8px; }
        .track-artist { font-size: 14px; color: var(--text-secondary); }

        /* 进度条 */
        .progress-container {
            height: 4px; background: #444; border-radius: 2px; margin-bottom: 25px;
            position: relative; cursor: pointer;
        }
        .progress-bar {
            height: 100%; background: var(--text); border-radius: 2px; width: 0%;
            transition: width 0.1s linear;
        }
        .time-stamps { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-secondary); margin-top: 5px; }

        /* 控制按钮 */
        .controls {
            display: flex; align-items: center; justify-content: center; gap: 30px;
            margin-bottom: 30px;
        }
        .control-btn {
            background: none; border: none; color: var(--text); cursor: pointer;
            opacity: 0.8; transition: 0.2s;
        }
        .control-btn:hover { opacity: 1; }
        .control-btn.main {
            width: 64px; height: 64px; border-radius: 50%; background: var(--text);
            color: var(--bg); display: flex; align-items: center; justify-content: center;
            font-size: 28px;
        }
        .control-btn.main:active { transform: scale(0.95); }

        /* 声音切换 */
        .voice-switch { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .voice-btn {
            background: rgba(255,255,255,0.1); border: none; color: var(--text-secondary);
            padding: 6px 12px; border-radius: 15px; font-size: 12px; cursor: pointer;
        }
        .voice-btn.active { background: var(--text); color: var(--bg); font-weight: bold; }

        /* 播放列表 */
        .playlist { flex: 1; overflow-y: auto; scrollbar-width: none; }
        .playlist::-webkit-scrollbar { display: none; }
        .playlist-item {
            display: flex; align-items: center; padding: 12px; border-radius: 8px;
            margin-bottom: 5px; cursor: pointer; transition: 0.2s;
        }
        .playlist-item:hover { background: rgba(255,255,255,0.1); }
        .playlist-item.active { background: rgba(255,255,255,0.15); }
        .item-idx { font-size: 14px; color: var(--text-secondary); width: 30px; text-align: center; }
        .item-info { flex: 1; overflow: hidden; }
        .item-title { font-size: 14px; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .item-desc { font-size: 12px; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-top: 4px; }
        .item-tag { font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: 10px; }

    </style>
</head>
<body>

<div class="bg-overlay"></div>

<header>
    <span class="live-badge">LIVE</span>
    <span id="timeDisplay">全网资讯通 · Loading...</span>
</header>

<div class="player-container">
    <div class="album-art" id="albumArt" data-cat="科技">
        TECH NEWS
    </div>

    <div class="track-info">
        <div class="track-title" id="currentTitle">全网资讯通</div>
        <div class="track-artist" id="currentArtist">AI 主播 · 每日播报</div>
    </div>

    <div class="voice-switch" id="voiceContainer"></div>

    <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
        <div class="time-stamps">
            <span id="currentTime">0:00</span>
            <span id="duration">0:00</span>
        </div>
    </div>

    <div class="controls">
        <button class="control-btn"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg></button>
        <button class="control-btn main" id="playBtn">▶</button>
        <button class="control-btn"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg></button>
    </div>

    <div class="playlist" id="playlist">
        </div>
</div>

<audio id="audioPlayer"></audio>

<script>
    const audio = document.getElementById('audioPlayer');
    const playBtn = document.getElementById('playBtn');
    const progressBar = document.getElementById('progressBar');
    const progressContainer = document.getElementById('progressContainer');
    const currentTimeEl = document.getElementById('currentTime');
    const durationEl = document.getElementById('duration');
    const albumArt = document.getElementById('albumArt');
    const currentTitle = document.getElementById('currentTitle');
    
    let currentVoice = 'yunxi';
    let newsData = [];
    const ts = new Date().getTime();

    // --- 初始化 ---
    fetch(`news_data.json?t=${ts}`)
        .then(res => res.json())
        .then(data => {
            newsData = data.news;
            document.getElementById('timeDisplay').innerText = `全网资讯通 · ${data.hour}:00 更新`;
            
            // 生成声音按钮
            const vBox = document.getElementById('voiceContainer');
            data.voices.forEach(v => {
                let btn = document.createElement('button');
                btn.className = `voice-btn ${v.id === currentVoice ? 'active' : ''}`;
                btn.innerText = v.label.split('·')[0];
                btn.onclick = () => switchVoice(v.id, btn);
                vBox.appendChild(btn);
            });

            // 加载音频
            loadAudio(currentVoice);

            // 生成播放列表
            const playlist = document.getElementById('playlist');
            playlist.innerHTML = '';
            data.news.forEach((item, idx) => {
                const catColor = item.category === '科技' ? 'var(--accent-tech)' : (item.category === '娱乐' ? 'var(--accent-ent)' : 'var(--accent-weird)');
                playlist.innerHTML += `
                    <div class="playlist-item">
                        <div class="item-idx">${idx + 1}</div>
                        <div class="item-info">
                            <div class="item-title">${item.title}</div>
                            <div class="item-desc">${item.summary}</div>
                        </div>
                        <div class="item-tag" style="background:${catColor};color:#000;">${item.category}</div>
                    </div>
                `;
            });
            // 默认显示第一条新闻的信息
            updateDisplay(0);
        })
        .catch(err => {
            currentTitle.innerText = "信号中断，请刷新";
        });

    // --- 逻辑控制 ---
    function loadAudio(voiceId) {
        audio.src = `radio_${voiceId}.mp3?v=${ts}`;
    }

    function switchVoice(id, btnEl) {
        if (id === currentVoice) return;
        currentVoice = id;
        document.querySelectorAll('.voice-btn').forEach(b => b.classList.remove('active'));
        btnEl.classList.add('active');
        
        const isPlaying = !audio.paused;
        loadAudio(id);
        if (isPlaying) audio.play();
    }

    function updateDisplay(idx) {
        const item = newsData[idx];
        albumArt.innerText = item.category + " NEWS";
        albumArt.setAttribute('data-cat', item.category);
        currentTitle.innerText = item.title;
        // 更改背景色
        const bgColors = { '科技': '#1e3a8a', '娱乐': '#831843', '奇闻': '#713f12' };
        document.body.style.backgroundColor = bgColors[item.category] || 'var(--bg)';
    }

    // 播放控制
    playBtn.onclick = () => {
        if (audio.paused) {
            audio.play();
            playBtn.innerText = "II";
        } else {
            audio.pause();
            playBtn.innerText = "▶";
        }
    };
    audio.onended = () => playBtn.innerText = "▶";

    // 进度条逻辑
    function formatTime(s) {
        const min = Math.floor(s / 60);
        const sec = Math.floor(s % 60);
        return `${min}:${sec < 10 ? '0' + sec : sec}`;
    }
    
    audio.ontimeupdate = () => {
        const percent = (audio.currentTime / audio.duration) * 100;
        progressBar.style.width = `${percent}%`;
        currentTimeEl.innerText = formatTime(audio.currentTime);
        durationEl.innerText = formatTime(audio.duration || 0);

        // 简单模拟：根据进度切换显示的新闻标题（假设每条新闻大概15秒）
        const estimatedIdx = Math.floor(audio.currentTime / 15);
        if (estimatedIdx < newsData.length) {
            updateDisplay(estimatedIdx);
        }
    };

    progressContainer.onclick = (e) => {
        const width = progressContainer.clientWidth;
        const clickX = e.offsetX;
        const duration = audio.duration;
        audio.currentTime = (clickX / width) * duration;
    };

</script>
</body>
</html>
